import{z as q,_ as w,c as r,b as a,a as e,f as v,A as V,F as x,u as C,d as L,t as m,w as M,e as T,r as p,o as c,x as S,y as F,n as g,B as A}from"./index-Usp75sxp.js";import{t as n,q as U}from"./swalToast-DMScG5K0.js";q("cartStore",{state:()=>({cart:[]}),actions:{}});var B={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"yu-t-200053",VITE_BASE_URL:"/Journey-into-the-Forest/",BASE_URL:"/Journey-into-the-Forest/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:u,VITE_PATH:h}=B,I={data(){return{carts:{},form:{user:{name:"",email:"",tel:"",address:""},message:""},isLoading:!1}},methods:{getCart(){const l=`${u}/api/${h}/cart`;this.isLoading=!0,this.axios.get(l).then(s=>{this.carts=s.data.data,this.isLoading=!1}).catch(()=>{n.fire({icon:"error",title:"取得購物車列表失敗。"})})},deleteModal(l,s){l?U.fire({icon:"question",title:"確定要清空購物車嗎？"}).then(d=>{d.isConfirmed&&this.deleteAll()}):U.fire({icon:"question",title:`確定要刪除「${s.product.title}」嗎？`}).then(d=>{d.isConfirmed&&this.deleteCart(s.id)})},deleteCart(l){const s=`${u}/api/${h}/cart/${l}`;this.axios.delete(s).then(()=>{this.getCart(),n.fire({icon:"success",title:"已刪除此產品！"})}).catch(()=>{n.fire({icon:"error",title:"刪除產品失敗。"})})},deleteAll(){const l=`${u}/api/${h}/carts`;this.axios.delete(l).then(()=>{this.getCart(),n.fire({icon:"success",title:"已清空購物車！"})}).catch(()=>{n.fire({icon:"error",title:"清空購物車失敗。"})})},changeQty(l,s){const d={product_id:l.product_id,qty:s},y=`${u}/api/${h}/cart/${l.id}`;this.axios.put(y,{data:d}).then(()=>{this.getCart(),n.fire({icon:"success",title:"已更新產品數量！"})}).catch(()=>{n.fire({icon:"error",title:"產品數量更新失敗。"})})},createOrder(){const l=`${u}/api/${h}/order`,s=this.form;this.axios.post(l,{data:s}).then(()=>{n.fire({icon:"success",title:"已成功送出訂單！"}),this.$router.push("/")}).catch(()=>{n.fire({icon:"error",title:"訂單送出失敗。"})})},isPhone(l){const s=/^(09)[0-9]{8}$/;return l.length===0?"電話 為必填":s.test(l)?!0:"請正確的手機號碼"}},mounted(){this.getCart()}},N=T('<section class="cart-banner img-box mb-4"><div class="container"><div class="cart-banner-title text-center w-100"><h1 class="title mb-0">購物車</h1><span class="english fs-5 title">Cart</span></div></div></section>',1),P={class:"container mb-7"},R={key:0,class:"text-center text-muted",role:"alert"},D=e("i",{class:"bi bi-stars me-1"},null,-1),O={class:"row"},z={class:"col-12 col-lg-8 mb-5 mb-lg-0"},H=["disabled","onClick"],J=e("i",{class:"bi bi-x-lg"},null,-1),Q=[J],j={class:"row gx-2 align-items-center"},G={class:"col-12 col-sm-3 mb-1 mb-sm-0"},K=["src","alt"],W={class:"col-12 col-sm-5 mb-1 mb-sm-0"},X={class:"fs-5"},Y=e("br",null,null,-1),Z={class:"text-muted fs-7"},$={class:"text-dark-green"},ee={class:"col-12 col-sm-2"},se=["disabled","onUpdate:modelValue","onChange"],te=["value"],oe={class:"col-12 col-sm-2 text-end text-primary"},ie={key:0,class:"d-flex justify-content-between pe-3"},le=["disabled"],ae=e("i",{class:"bi bi-trash3 me-1"},null,-1),ne={class:"fs-4 text-danger ls-2"},re={key:0,class:"col-12 col-lg-4"},ce={class:"product-description p-5"},de=e("div",{class:"mb-3"},[e("h4",{class:"title mb-0"},"購買人資料"),e("span",{class:"english title ls-2 fs-7"},"Purchaser Information")],-1),me={class:"form-floating mb-3"},_e=e("label",{for:"email"},"Email",-1),ue={class:"form-floating mb-3"},he=e("label",{for:"name"},"收件人姓名",-1),fe={class:"form-floating mb-3"},be=e("label",{for:"tel"},"收件人電話",-1),pe={class:"form-floating mb-3"},ge=e("label",{for:"address"},"收件人地址",-1),ve={class:"form-floating mb-3"},Ve=e("label",{for:"message"},"留言",-1),xe={class:"text-end"},ye=["disabled"],Ce=e("i",{class:"bi bi-send me-1"},null,-1);function Le(l,s,d,y,t,_){const k=p("VueLoading"),f=p("VeeField"),b=p("ErrorMessage"),E=p("VeeForm");return c(),r(x,null,[a(k,{active:t.isLoading},null,8,["active"]),N,e("section",P,[t.carts.carts&&!t.carts.carts.length?(c(),r("div",R,[D,v("目前購物車是空的，趕快加入你的漫遊行程吧！ ")])):V("",!0),e("div",O,[e("div",z,[(c(!0),r(x,null,C(t.carts.carts,o=>(c(),r("div",{class:"p-3 mb-2 bg-secondary rounded-3 d-flex border border-1",key:o.id},[e("button",{type:"button",class:"btn ps-0",disabled:t.isLoading,onClick:L(i=>_.deleteModal(!1,o),["prevent"])},Q,8,H),e("div",j,[e("div",G,[e("img",{src:o.product.imageUrl,alt:o.product.title,class:"w-100 rounded-3"},null,8,K)]),e("div",W,[e("span",X,m(o.product.title),1),Y,e("del",Z," 原 $"+m(o.product.origin_price?o.product.origin_price.toLocaleString("en-US"):""),1),e("span",$," 特價 $"+m(o.product.price?o.product.price.toLocaleString("en-US"):""),1)]),e("div",ee,[S(e("select",{class:"form-select form-select-sm mb-1 mb-sm-0",disabled:t.isLoading,"onUpdate:modelValue":i=>o.qty=i,onChange:i=>_.changeQty(o,o.qty)},[(c(),r(x,null,C(10,i=>e("option",{key:i,value:i},m(i)+" 張",9,te)),64))],40,se),[[F,o.qty]])]),e("div",oe," 小計 $"+m(o.total?o.total.toLocaleString("en-US"):""),1)])]))),128)),t.carts.carts&&t.carts.carts.length?(c(),r("div",ie,[e("button",{type:"button",class:"btn btn-outline-dark-green",disabled:t.isLoading,onClick:s[0]||(s[0]=L(o=>_.deleteModal(!0),["prevent"]))},[ae,v("清空購物車 ")],8,le),e("div",ne," 總計 $"+m(t.carts.total?t.carts.total.toLocaleString("en-US"):""),1)])):V("",!0)]),t.carts.carts&&t.carts.carts.length?(c(),r("div",re,[e("div",ce,[de,a(E,{onSubmit:s[6]||(s[6]=o=>_.createOrder()),ref:"form"},{default:M(({errors:o})=>[e("div",me,[a(f,{id:"email",name:"email",type:"email",class:g(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:t.form.user.email,"onUpdate:modelValue":s[1]||(s[1]=i=>t.form.user.email=i)},null,8,["class","modelValue"]),_e,a(b,{name:"email",class:"invalid-feedback"})]),e("div",ue,[a(f,{id:"name",name:"姓名",type:"name",class:g(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:t.form.user.name,"onUpdate:modelValue":s[2]||(s[2]=i=>t.form.user.name=i)},null,8,["class","modelValue"]),he,a(b,{name:"姓名",class:"invalid-feedback"})]),e("div",fe,[a(f,{id:"tel",name:"電話",type:"tel",class:g(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:_.isPhone,modelValue:t.form.user.tel,"onUpdate:modelValue":s[3]||(s[3]=i=>t.form.user.tel=i)},null,8,["class","rules","modelValue"]),be,a(b,{name:"電話",class:"invalid-feedback"})]),e("div",pe,[a(f,{id:"address",name:"地址",type:"text",class:g(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:t.form.user.address,"onUpdate:modelValue":s[4]||(s[4]=i=>t.form.user.address=i)},null,8,["class","modelValue"]),ge,a(b,{name:"地址",class:"invalid-feedback"})]),e("div",ve,[S(e("textarea",{id:"message",name:"留言",class:"form-control",placeholder:"請輸入留言","onUpdate:modelValue":s[5]||(s[5]=i=>t.form.message=i)},null,512),[[A,t.form.message]]),Ve]),e("div",xe,[e("button",{type:"submit",class:"btn btn-primary text-white",disabled:t.carts.carts?t.carts.carts.final_total:""===0},[Ce,v("送出訂單 ")],8,ye)])]),_:1},512)])])):V("",!0)])])],64)}const ke=w(I,[["render",Le]]);export{ke as default};
