import{_ as D,o,c as n,a as t,t as s,B as $,F as g,v as O,y as k,H as M,d as y,E as m,b as h,r as p}from"./index-BEUrjnwo.js";import{P as C,D as E}from"./DeleteModal-DOZS6PG9.js";import{M as V}from"./bootstrap.esm-NBXIyAKZ.js";import{t as u}from"./swalToast-CbIc0a0w.js";const S={data(){return{orderModal:"",tempOrderData:{}}},props:["tempOrder"],methods:{openModal(){this.tempOrderData={...this.tempOrder},this.orderModal.show()},hideModal(){this.orderModal.hide()},updateOrder(){this.$emit("updateOrder",this.tempOrderData)}},mounted(){this.orderModal=new V(this.$refs.orderModal,{keyboard:!1,backdrop:"static"})}},P={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"orderModal"},U={class:"modal-dialog modal-xl"},T={class:"modal-content"},I=t("div",{class:"modal-header bg-dark"},[t("h5",{class:"modal-title text-white"},"訂單細節"),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),B={class:"modal-body"},R={class:"row"},A={class:"col-4"},F=t("h3",null,"用戶資料",-1),H={class:"table"},N={key:0},q=t("th",null,"姓名",-1),G=t("th",null,"Email",-1),J=t("th",null,"電話",-1),j=t("th",null,"地址",-1),z={class:"col-8"},K=t("h3",null,"訂單細節",-1),Q={class:"table"},W=t("th",null,"訂單編號",-1),X=t("th",null,"下單時間",-1),Y=t("th",null,"付款時間",-1),Z={key:0},tt={key:1,class:"text-muted"},et=t("th",null,"付款狀態",-1),st={key:0,class:"text-success"},ot={key:1,class:"text-muted"},nt=t("th",null,"總金額",-1),it=t("h3",null,"選購商品",-1),lt={class:"table"},at={class:"form-check d-flex justify-content-end"},dt={class:"form-check-label",for:"is_paid"},rt={key:0},ct={key:1},_t={class:"modal-footer"},ut=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ht(a,l,_,v,e,c){return o(),n("div",P,[t("div",U,[t("div",T,[I,t("div",B,[t("div",R,[t("div",A,[F,t("table",H,[e.tempOrderData.user?(o(),n("tbody",N,[t("tr",null,[q,t("td",null,s(e.tempOrderData.user.name),1)]),t("tr",null,[G,t("td",null,s(e.tempOrderData.user.email),1)]),t("tr",null,[J,t("td",null,s(e.tempOrderData.user.tel),1)]),t("tr",null,[j,t("td",null,s(e.tempOrderData.user.address),1)])])):$("",!0)])]),t("div",z,[K,t("table",Q,[t("tbody",null,[t("tr",null,[W,t("td",null,s(e.tempOrderData.id),1)]),t("tr",null,[X,t("td",null,s(new Date(e.tempOrderData.create_at*1e3).toLocaleDateString()),1)]),t("tr",null,[Y,t("td",null,[e.tempOrderData.paid_date?(o(),n("span",Z,s(new Date(e.tempOrderData.paid_date*1e3).toLocaleDateString()),1)):(o(),n("span",tt,"尚未付款"))])]),t("tr",null,[et,t("td",null,[e.tempOrderData.is_paid?(o(),n("strong",st,"已付款")):(o(),n("span",ot,"尚未付款"))])]),t("tr",null,[nt,t("td",null,s(e.tempOrderData.total),1)])])]),it,t("table",lt,[(o(!0),n(g,null,O(e.tempOrderData.products,d=>(o(),n("tr",{key:d.id},[t("th",null,s(d.product.title),1),t("td",null,s(d.qty)+" / "+s(d.product.unit),1),t("td",null,s(d.total),1)]))),128))]),t("div",at,[k(t("input",{class:"form-check-input me-1",type:"checkbox",value:"",id:"is_paid","onUpdate:modelValue":l[0]||(l[0]=d=>e.tempOrderData.is_paid=d)},null,512),[[M,e.tempOrderData.is_paid]]),t("label",dt,[e.tempOrderData.is_paid?(o(),n("span",rt,"已付款")):(o(),n("span",ct,"未付款"))])])])])]),t("div",_t,[ut,t("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=y(d=>c.updateOrder(_.tempOrder),["prevent"]))}," 修改付款狀態 ")])])])],512)}const pt=D(S,[["render",ht]]);var mt={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"yu-t-200053",VITE_BASE_URL:"/Journey-into-the-Forest/",BASE_URL:"/Journey-into-the-Forest/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:b}=mt,ft={data(){return{orders:{},pagination:{},isLoading:!1,tempOrder:{}}},components:{PaginationComponent:C,OrderModal:pt,DeleteModal:E},methods:{getOrders(a=1){const l=`${f}/api/${b}/admin/orders?page=${a}`;this.isLoading=!0,m.get(l).then(_=>{this.orders=_.data.orders,this.pagination=_.data.pagination,this.isLoading=!1}).catch(()=>{u.fire({icon:"error",title:"取得訂單列表失敗。"}),this.isLoading=!1})},openModal(a,l){this.tempOrder={...a},this.isLoading=!0,l==="view"?(this.$nextTick(()=>{this.$refs.orderModal.openModal()}),this.isLoading=!1):l==="delete"&&(this.$refs.deleteModal.openModal(),this.isLoading=!1)},updateOrder(a){const l=`${f}/api/${b}/admin/order/${a.id}`,_={is_paid:a.is_paid};this.isLoading=!0,m.put(l,{data:_}).then(()=>{u.fire({icon:"success",title:"成功付款資訊！"}),this.$refs.orderModal.hideModal(),this.getOrders(this.pagination.current_page),this.isLoading=!1}).catch(()=>{u.fire({icon:"error",title:"修改付款資訊失敗。"}),this.isLoading=!1})},deleteOrder(){const a=`${f}/api/${b}/admin/order/${this.tempOrder.id}`;this.isLoading=!0,m.delete(a).then(l=>{u.fire({icon:"success",title:"已成功刪除此訂單！"}),this.getOrders(this.pagination.current_page),this.$refs.deleteModal.hideModal(),this.isLoading=!1}).catch(()=>{u.fire({icon:"error",title:"刪除訂單失敗。"}),this.isLoading=!1})}},mounted(){this.getOrders()}},bt={class:"container mx-auto"},gt=t("h2",{class:"text-center"},"後台訂單",-1),Ot={class:"table align-middle"},yt=t("thead",null,[t("tr",null,[t("td",null,"購買時間"),t("td",{width:"25%"},"Email"),t("td",{width:"25%"},"購買款項"),t("td",null,"應付金額"),t("td",null,"是否付款"),t("td",null,"編輯")])],-1),Dt={class:"list-unstyled"},kt={class:"form-check form-switch"},Mt=["id","onUpdate:modelValue","checked","onChange"],vt=["for"],Lt={key:0},xt={key:1},wt={class:"btn-group btn-group-sm",role:"group","aria-label":"edit"},$t=["onClick"],Ct=["onClick"];function Et(a,l,_,v,e,c){const d=p("VueLoading"),L=p("PaginationComponent"),x=p("OrderModal"),w=p("DeleteModal");return o(),n("div",bt,[h(d,{active:e.isLoading},null,8,["active"]),gt,t("table",Ot,[yt,t("tbody",null,[(o(!0),n(g,null,O(e.orders,i=>(o(),n("tr",{key:i.id},[t("td",null,s(new Date(i.create_at*1e3).toLocaleDateString()),1),t("td",null,s(i.user.email),1),t("td",null,[t("ul",Dt,[(o(!0),n(g,null,O(i.products,r=>(o(),n("li",{key:r.id},s(r.product.title)+" "+s(r.qty)+" "+s(r.product.unit),1))),128))])]),t("td",null,s(i.total),1),t("td",null,[t("div",kt,[k(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`paidSwitch${i.id}`,"onUpdate:modelValue":r=>i.is_paid=r,checked:i.is_paid,onChange:r=>c.updateOrder(i)},null,40,Mt),[[M,i.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${i.id}`},[i.is_paid?(o(),n("span",Lt,"已付款")):(o(),n("span",xt,"未付款"))],8,vt)])]),t("td",null,[t("div",wt,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:y(r=>c.openModal(i,"view"),["prevent"])}," 檢視 ",8,$t),t("button",{type:"button",class:"btn btn-outline-danger",onClick:y(r=>c.openModal(i,"delete"),["prevent"])}," 刪除 ",8,Ct)])])]))),128))])]),h(L,{pagination:e.pagination,onGetProducts:c.getOrders},null,8,["pagination","onGetProducts"]),h(x,{ref:"orderModal","temp-order":e.tempOrder,onUpdateOrder:c.updateOrder},null,8,["temp-order","onUpdateOrder"]),h(w,{ref:"deleteModal","temp-item":e.tempOrder,onDeleteItem:c.deleteOrder},null,8,["temp-item","onDeleteItem"])])}const Tt=D(ft,[["render",Et]]);export{Tt as default};
