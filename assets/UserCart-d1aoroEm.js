import{c as k}from"./cartStore-xWKfdcx_.js";import{_ as M,m as T,B as A,c as r,b as i,a as e,f as b,w as S,g as V,F as y,x,d as U,t as m,e as F,r as u,o as c,z as L,A as N,n as p,C as B}from"./index-Gg14AAOj.js";import{q as E,t as n}from"./swalToast-CDlLFnqe.js";var I={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"yu-t-200053",VITE_BASE_URL:"/Journey-into-the-Forest/",BASE_URL:"/Journey-into-the-Forest/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:g,VITE_PATH:v}=I,R={data(){return{form:{user:{name:"",email:"",tel:"",address:""},message:""}}},computed:{...T(k,["carts","isLoading"])},methods:{...A(k,["getCart"]),deleteModal(t,s){t?E.fire({icon:"question",title:"確定要清空購物車嗎？"}).then(d=>{d.isConfirmed&&this.deleteAll()}):E.fire({icon:"question",title:`確定要刪除「${s.product.title}」嗎？`}).then(d=>{d.isConfirmed&&this.deleteCart(s.id)})},deleteCart(t){const s=`${g}/api/${v}/cart/${t}`;this.axios.delete(s).then(()=>{this.getCart(),n.fire({icon:"success",title:"已刪除此產品！"})}).catch(()=>{n.fire({icon:"error",title:"刪除產品失敗。"})})},deleteAll(){const t=`${g}/api/${v}/carts`;this.axios.delete(t).then(()=>{this.getCart(),n.fire({icon:"success",title:"已清空購物車！"})}).catch(()=>{n.fire({icon:"error",title:"清空購物車失敗。"})})},changeQty(t,s){const d={product_id:t.product_id,qty:s},C=`${g}/api/${v}/cart/${t.id}`;this.axios.put(C,{data:d}).then(()=>{this.getCart(),n.fire({icon:"success",title:"已更新產品數量！"})}).catch(()=>{n.fire({icon:"error",title:"產品數量更新失敗。"})})},createOrder(){const t=`${g}/api/${v}/order`,s=this.form;this.axios.post(t,{data:s}).then(()=>{n.fire({icon:"success",title:"已成功送出訂單！"}),this.$router.push("/")}).catch(()=>{n.fire({icon:"error",title:"訂單送出失敗。"})})},isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"請正確的手機號碼"}},mounted(){this.getCart()}},D=F('<section class="cart-banner img-box mb-4"><div class="container"><div class="cart-banner-title text-center w-100"><h1 class="title mb-0">購物車</h1><span class="english fs-5 title">Cart</span></div></div></section>',1),P={class:"container mb-7"},O={key:0,class:"d-flex flex-column align-items-center text-muted",role:"alert"},z=e("i",{class:"bi bi-stars me-1"},null,-1),H={class:"row"},J={class:"col-12 col-lg-8 mb-5 mb-lg-0"},Q={class:"row gx-2 align-items-center"},j={class:"col-12 col-sm-3 mb-1 mb-sm-0"},G=["src","alt"],K={class:"col-12 col-sm-5 mb-1 mb-sm-0"},W={class:"fs-5"},X=e("br",null,null,-1),Y={class:"text-muted fs-7"},Z={class:"text-dark-green"},ee={class:"col-12 col-sm-2"},te=["disabled","onUpdate:modelValue","onChange"],se=["value"],oe={class:"col-12 col-sm-2 text-end text-primary"},le=["disabled","onClick"],ie=e("i",{class:"bi bi-x-lg"},null,-1),ae=[ie],ne={key:0,class:"d-flex justify-content-between pe-3"},re=["disabled"],ce=e("i",{class:"bi bi-trash3 me-1"},null,-1),de={class:"fs-4 text-danger ls-2"},me={key:0,class:"col-12 col-lg-4"},ue={class:"product-description p-5"},_e=e("div",{class:"mb-3"},[e("h4",{class:"title mb-0"},"購買人資料"),e("span",{class:"english title ls-2 fs-7"},"Purchaser Information")],-1),fe={class:"form-floating mb-3"},he=e("label",{for:"email"},"Email",-1),be={class:"form-floating mb-3"},pe=e("label",{for:"name"},"收件人姓名",-1),ge={class:"form-floating mb-3"},ve=e("label",{for:"tel"},"收件人電話",-1),Ve={class:"form-floating mb-3"},ye=e("label",{for:"address"},"收件人地址",-1),Ce={class:"form-floating mb-3"},ke=e("label",{for:"message"},"留言",-1),Se={class:"text-end"},xe=["disabled"],Ue=e("i",{class:"bi bi-send me-1"},null,-1);function Le(t,s,d,C,a,_){const q=u("VueLoading"),w=u("router-link"),f=u("VeeField"),h=u("ErrorMessage"),$=u("VeeForm");return c(),r(y,null,[i(q,{active:t.isLoading},null,8,["active"]),D,e("section",P,[t.carts.carts&&!t.carts.carts.length?(c(),r("div",O,[b(" 目前購物車是空的，趕快加入你的漫遊行程吧！ "),i(w,{to:"/products",class:"btn btn-primary text-white mt-1"},{default:S(()=>[z,b("立即尋找專屬行程 ")]),_:1})])):V("",!0),e("div",H,[e("div",J,[(c(!0),r(y,null,x(t.carts.carts,o=>(c(),r("div",{class:"p-3 mb-2 bg-secondary rounded-3 d-flex border border-1",key:o.id},[e("div",Q,[e("div",j,[e("img",{src:o.product.imageUrl,alt:o.product.title,class:"w-100 rounded-3"},null,8,G)]),e("div",K,[e("span",W,m(o.product.title),1),X,e("del",Y," 原 $"+m(o.product.origin_price?o.product.origin_price.toLocaleString("en-US"):""),1),e("span",Z," 特價 $"+m(o.product.price?o.product.price.toLocaleString("en-US"):""),1)]),e("div",ee,[L(e("select",{class:"form-select form-select-sm mb-1 mb-sm-0",disabled:t.isLoading,"onUpdate:modelValue":l=>o.qty=l,onChange:l=>_.changeQty(o,o.qty)},[(c(),r(y,null,x(10,l=>e("option",{key:l,value:l},m(l)+" 張",9,se)),64))],40,te),[[N,o.qty]])]),e("div",oe," 小計 $"+m(o.total?o.total.toLocaleString("en-US"):""),1)]),e("button",{type:"button",class:"btn ps-3",disabled:t.isLoading,onClick:U(l=>_.deleteModal(!1,o),["prevent"]),title:"刪除此行程"},ae,8,le)]))),128)),t.carts.carts&&t.carts.carts.length?(c(),r("div",ne,[e("button",{type:"button",class:"btn btn-outline-dark-green",disabled:t.isLoading,onClick:s[0]||(s[0]=U(o=>_.deleteModal(!0),["prevent"]))},[ce,b("清空購物車 ")],8,re),e("div",de," 總計 $"+m(t.carts.total?t.carts.total.toLocaleString("en-US"):""),1)])):V("",!0)]),t.carts.carts&&t.carts.carts.length?(c(),r("div",me,[e("div",ue,[_e,i($,{onSubmit:s[6]||(s[6]=o=>_.createOrder()),ref:"form"},{default:S(({errors:o})=>[e("div",fe,[i(f,{id:"email",name:"email",type:"email",class:p(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:a.form.user.email,"onUpdate:modelValue":s[1]||(s[1]=l=>a.form.user.email=l)},null,8,["class","modelValue"]),he,i(h,{name:"email",class:"invalid-feedback"})]),e("div",be,[i(f,{id:"name",name:"姓名",type:"name",class:p(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:a.form.user.name,"onUpdate:modelValue":s[2]||(s[2]=l=>a.form.user.name=l)},null,8,["class","modelValue"]),pe,i(h,{name:"姓名",class:"invalid-feedback"})]),e("div",ge,[i(f,{id:"tel",name:"電話",type:"tel",class:p(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:{required:!0,max:10,min:8},modelValue:a.form.user.tel,"onUpdate:modelValue":s[3]||(s[3]=l=>a.form.user.tel=l)},null,8,["class","modelValue"]),ve,i(h,{name:"電話",class:"invalid-feedback"})]),e("div",Ve,[i(f,{id:"address",name:"地址",type:"text",class:p(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:a.form.user.address,"onUpdate:modelValue":s[4]||(s[4]=l=>a.form.user.address=l)},null,8,["class","modelValue"]),ye,i(h,{name:"地址",class:"invalid-feedback"})]),e("div",Ce,[L(e("textarea",{id:"message",name:"留言",class:"form-control",placeholder:"請輸入留言","onUpdate:modelValue":s[5]||(s[5]=l=>a.form.message=l)},null,512),[[B,a.form.message]]),ke]),e("div",Se,[e("button",{type:"submit",class:"btn btn-primary text-white",disabled:t.carts.carts?t.carts.carts.final_total:""===0},[Ue,b("送出訂單 ")],8,xe)])]),_:1},512)])])):V("",!0)])])],64)}const $e=M(R,[["render",Le]]);export{$e as default};
