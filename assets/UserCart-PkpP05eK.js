import{z as M,_ as T,c as r,b as n,a as e,f as g,w as C,A as x,F as V,u as k,d as L,t as m,e as F,r as u,o as c,x as S,y as A,n as v,B as N}from"./index-CDpyaTZl.js";import{t as a,q as U}from"./swalToast-DSnffynP.js";M("cartStore",{state:()=>({cart:[]}),actions:{}});var B={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"yu-t-200053",VITE_BASE_URL:"/Journey-into-the-Forest/",BASE_URL:"/Journey-into-the-Forest/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:_,VITE_PATH:h}=B,I={data(){return{carts:{},form:{user:{name:"",email:"",tel:"",address:""},message:""},isLoading:!1}},methods:{getCart(){const l=`${_}/api/${h}/cart`;this.isLoading=!0,this.axios.get(l).then(t=>{this.carts=t.data.data,this.isLoading=!1}).catch(()=>{a.fire({icon:"error",title:"取得購物車列表失敗。"})})},deleteModal(l,t){l?U.fire({icon:"question",title:"確定要清空購物車嗎？"}).then(d=>{d.isConfirmed&&this.deleteAll()}):U.fire({icon:"question",title:`確定要刪除「${t.product.title}」嗎？`}).then(d=>{d.isConfirmed&&this.deleteCart(t.id)})},deleteCart(l){const t=`${_}/api/${h}/cart/${l}`;this.axios.delete(t).then(()=>{this.getCart(),a.fire({icon:"success",title:"已刪除此產品！"})}).catch(()=>{a.fire({icon:"error",title:"刪除產品失敗。"})})},deleteAll(){const l=`${_}/api/${h}/carts`;this.axios.delete(l).then(()=>{this.getCart(),a.fire({icon:"success",title:"已清空購物車！"})}).catch(()=>{a.fire({icon:"error",title:"清空購物車失敗。"})})},changeQty(l,t){const d={product_id:l.product_id,qty:t},y=`${_}/api/${h}/cart/${l.id}`;this.axios.put(y,{data:d}).then(()=>{this.getCart(),a.fire({icon:"success",title:"已更新產品數量！"})}).catch(()=>{a.fire({icon:"error",title:"產品數量更新失敗。"})})},createOrder(){const l=`${_}/api/${h}/order`,t=this.form;this.axios.post(l,{data:t}).then(()=>{a.fire({icon:"success",title:"已成功送出訂單！"}),this.$router.push("/")}).catch(()=>{a.fire({icon:"error",title:"訂單送出失敗。"})})},isPhone(l){return/^(09)[0-9]{8}$/.test(l)?!0:"請正確的手機號碼"}},mounted(){this.getCart()}},R=F('<section class="cart-banner img-box mb-4"><div class="container"><div class="cart-banner-title text-center w-100"><h1 class="title mb-0">購物車</h1><span class="english fs-5 title">Cart</span></div></div></section>',1),D={class:"container mb-7"},P={key:0,class:"d-flex flex-column align-items-center text-muted",role:"alert"},O=e("i",{class:"bi bi-stars me-1"},null,-1),z={class:"row"},H={class:"col-12 col-lg-8 mb-5 mb-lg-0"},J={class:"row gx-2 align-items-center"},Q={class:"col-12 col-sm-3 mb-1 mb-sm-0"},j=["src","alt"],G={class:"col-12 col-sm-5 mb-1 mb-sm-0"},K={class:"fs-5"},W=e("br",null,null,-1),X={class:"text-muted fs-7"},Y={class:"text-dark-green"},Z={class:"col-12 col-sm-2"},$=["disabled","onUpdate:modelValue","onChange"],ee=["value"],te={class:"col-12 col-sm-2 text-end text-primary"},se=["disabled","onClick"],oe=e("i",{class:"bi bi-x-lg"},null,-1),ie=[oe],le={key:0,class:"d-flex justify-content-between pe-3"},ne=["disabled"],ae=e("i",{class:"bi bi-trash3 me-1"},null,-1),re={class:"fs-4 text-danger ls-2"},ce={key:0,class:"col-12 col-lg-4"},de={class:"product-description p-5"},me=e("div",{class:"mb-3"},[e("h4",{class:"title mb-0"},"購買人資料"),e("span",{class:"english title ls-2 fs-7"},"Purchaser Information")],-1),ue={class:"form-floating mb-3"},_e=e("label",{for:"email"},"Email",-1),he={class:"form-floating mb-3"},fe=e("label",{for:"name"},"收件人姓名",-1),be={class:"form-floating mb-3"},pe=e("label",{for:"tel"},"收件人電話",-1),ge={class:"form-floating mb-3"},ve=e("label",{for:"address"},"收件人地址",-1),xe={class:"form-floating mb-3"},Ve=e("label",{for:"message"},"留言",-1),ye={class:"text-end"},Ce=["disabled"],ke=e("i",{class:"bi bi-send me-1"},null,-1);function Le(l,t,d,y,s,f){const E=u("VueLoading"),q=u("router-link"),b=u("VeeField"),p=u("ErrorMessage"),w=u("VeeForm");return c(),r(V,null,[n(E,{active:s.isLoading},null,8,["active"]),R,e("section",D,[s.carts.carts&&!s.carts.carts.length?(c(),r("div",P,[g(" 目前購物車是空的，趕快加入你的漫遊行程吧！ "),n(q,{to:"/products",class:"btn btn-primary text-white mt-1"},{default:C(()=>[O,g("立即尋找專屬行程 ")]),_:1})])):x("",!0),e("div",z,[e("div",H,[(c(!0),r(V,null,k(s.carts.carts,o=>(c(),r("div",{class:"p-3 mb-2 bg-secondary rounded-3 d-flex border border-1",key:o.id},[e("div",J,[e("div",Q,[e("img",{src:o.product.imageUrl,alt:o.product.title,class:"w-100 rounded-3"},null,8,j)]),e("div",G,[e("span",K,m(o.product.title),1),W,e("del",X," 原 $"+m(o.product.origin_price?o.product.origin_price.toLocaleString("en-US"):""),1),e("span",Y," 特價 $"+m(o.product.price?o.product.price.toLocaleString("en-US"):""),1)]),e("div",Z,[S(e("select",{class:"form-select form-select-sm mb-1 mb-sm-0",disabled:s.isLoading,"onUpdate:modelValue":i=>o.qty=i,onChange:i=>f.changeQty(o,o.qty)},[(c(),r(V,null,k(10,i=>e("option",{key:i,value:i},m(i)+" 張",9,ee)),64))],40,$),[[A,o.qty]])]),e("div",te," 小計 $"+m(o.total?o.total.toLocaleString("en-US"):""),1)]),e("button",{type:"button",class:"btn ps-3",disabled:s.isLoading,onClick:L(i=>f.deleteModal(!1,o),["prevent"]),title:"刪除此行程"},ie,8,se)]))),128)),s.carts.carts&&s.carts.carts.length?(c(),r("div",le,[e("button",{type:"button",class:"btn btn-outline-dark-green",disabled:s.isLoading,onClick:t[0]||(t[0]=L(o=>f.deleteModal(!0),["prevent"]))},[ae,g("清空購物車 ")],8,ne),e("div",re," 總計 $"+m(s.carts.total?s.carts.total.toLocaleString("en-US"):""),1)])):x("",!0)]),s.carts.carts&&s.carts.carts.length?(c(),r("div",ce,[e("div",de,[me,n(w,{onSubmit:t[6]||(t[6]=o=>f.createOrder()),ref:"form"},{default:C(({errors:o})=>[e("div",ue,[n(b,{id:"email",name:"email",type:"email",class:v(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=i=>s.form.user.email=i)},null,8,["class","modelValue"]),_e,n(p,{name:"email",class:"invalid-feedback"})]),e("div",he,[n(b,{id:"name",name:"姓名",type:"name",class:v(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=i=>s.form.user.name=i)},null,8,["class","modelValue"]),fe,n(p,{name:"姓名",class:"invalid-feedback"})]),e("div",be,[n(b,{id:"tel",name:"電話",type:"tel",class:v(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:{required:!0,max:10,min:8},modelValue:s.form.user.tel,"onUpdate:modelValue":t[3]||(t[3]=i=>s.form.user.tel=i)},null,8,["class","modelValue"]),pe,n(p,{name:"電話",class:"invalid-feedback"})]),e("div",ge,[n(b,{id:"address",name:"地址",type:"text",class:v(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":t[4]||(t[4]=i=>s.form.user.address=i)},null,8,["class","modelValue"]),ve,n(p,{name:"地址",class:"invalid-feedback"})]),e("div",xe,[S(e("textarea",{id:"message",name:"留言",class:"form-control",placeholder:"請輸入留言","onUpdate:modelValue":t[5]||(t[5]=i=>s.form.message=i)},null,512),[[N,s.form.message]]),Ve]),e("div",ye,[e("button",{type:"submit",class:"btn btn-primary text-white",disabled:s.carts.carts?s.carts.carts.final_total:""===0},[ke,g("送出訂單 ")],8,Ce)])]),_:1},512)])])):x("",!0)])])],64)}const Ee=T(I,[["render",Le]]);export{Ee as default};
